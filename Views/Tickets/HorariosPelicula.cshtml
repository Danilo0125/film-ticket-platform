@model List<ASP_MVC_Prueba.Controllers.HorarioTicketsViewModel>
@{
    ViewData["Title"] = "Horarios de Película";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
    var pelicula = ViewBag.Pelicula as ASP_MVC_Prueba.Models.Peliculas;
}

<div class="container-fluid px-4">
    <h1 class="mt-4">
        <i class="fas fa-clock me-2 text-primary"></i>Horarios de Película
    </h1>
    <ol class="breadcrumb mb-4">
        <li class="breadcrumb-item"><a asp-controller="Home" asp-action="Index">Dashboard</a></li>
        <li class="breadcrumb-item"><a asp-action="Index">Tickets por Película</a></li>
        <li class="breadcrumb-item active">Horarios de @pelicula?.Titulo</li>
    </ol>

    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <i class="fas fa-film me-1"></i>
            Información de la Película
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-2 text-center">
                    <img src="/img/peliculas/@pelicula?.Imagen" class="img-fluid rounded" 
                         style="max-height: 200px;" 
                         onerror="this.src='https://via.placeholder.com/200x300?text=Sin+Imagen'" />
                </div>
                <div class="col-md-10">
                    <h3>@pelicula?.Titulo</h3>
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong><i class="fas fa-tag me-2"></i>Género:</strong> @pelicula?.Genero</p>
                            <p><strong><i class="fas fa-clock me-2"></i>Duración:</strong> @pelicula?.Duracion minutos</p>
                            <p>
                                <strong><i class="fas fa-star me-2"></i>Estreno:</strong> 
                                @(pelicula?.Estreno == true ? "Sí" : "No")
                            </p>
                        </div>
                        <div class="col-md-6">
                            <p><strong><i class="fas fa-ticket-alt me-2"></i>Total Horarios:</strong> @Model.Count</p>
                            <p>
                                <strong><i class="fas fa-users me-2"></i>Total Tickets Vendidos:</strong> 
                                @Model.Sum(h => h.TotalTickets)
                            </p>
                            <p>
                                <strong><i class="fas fa-dollar-sign me-2"></i>Total Ventas:</strong> 
                                $@Model.Sum(h => h.TotalVentas).ToString("N2")
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="card shadow-sm mb-4">
        <div class="card-header">
            <i class="fas fa-calendar-alt me-1"></i>
            Horarios de @pelicula?.Titulo
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>
                                <i class="fas fa-calendar-day me-2 text-primary"></i>
                                Fecha
                            </th>
                            <th>
                                <i class="fas fa-clock me-2 text-primary"></i>
                                Hora
                            </th>
                            <th>
                                <i class="fas fa-door-open me-2 text-primary"></i>
                                Sala
                            </th>
                            <th>
                                <i class="fas fa-dollar-sign me-2 text-primary"></i>
                                Precio
                            </th>
                            <th>
                                <i class="fas fa-ticket-alt me-2 text-primary"></i>
                                Tickets
                            </th>
                            <th>
                                <i class="fas fa-money-bill-wave me-2 text-primary"></i>
                                Total
                            </th>
                            <th>
                                <i class="fas fa-cogs me-2 text-primary"></i>
                                Acciones
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            <tr>
                                <td>
                                    @(item.Horario?.FechaHora.ToShortDateString() ?? "N/A")
                                </td>
                                <td>
                                    @(item.Horario?.FechaHora.ToShortTimeString() ?? "N/A")
                                </td>
                                <td>
                                    @if (item.Horario?.Sala != null)
                                    {
                                        <span class="badge bg-info">@item.Horario.Sala.Nombre</span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-secondary">No disponible</span>
                                    }
                                </td>
                                <td>
                                    $@(item.Horario?.Precio.ToString("N2") ?? "0.00")
                                </td>
                                <td>
                                    <span class="badge bg-success">@item.TotalTickets</span>
                                </td>
                                <td>
                                    <span class="badge bg-primary">$@item.TotalVentas.ToString("N2")</span>
                                </td>
                                <td>
                                    @if (item.Horario != null)
                                    {
                                        <a asp-action="TicketsHorario" asp-route-id="@item.Horario.Id_Horarios" 
                                           class="btn btn-sm btn-primary">
                                            <i class="fas fa-ticket-alt me-2"></i>Ver Tickets
                                        </a>
                                    }
                                </td>
                            </tr>
                        }
                        @if (Model.Count == 0)
                        {
                            <tr>
                                <td colspan="7" class="text-center py-4">
                                    <div class="alert alert-info mb-0">
                                        <i class="fas fa-info-circle me-2"></i>No hay horarios para esta película
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="mt-3 mb-5">
        <a asp-action="Index" class="btn btn-secondary">
            <i class="fas fa-arrow-left me-2"></i>Volver a Películas
        </a>
    </div>
</div>
